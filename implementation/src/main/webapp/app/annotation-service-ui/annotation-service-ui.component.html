<ngx-loading-bar [includeSpinner]=false diameter="40px" height="14px" ></ngx-loading-bar>

<mat-tab-group dynamicHeight preserveContent [class.disable]="showResultContainer">
     <!-- ********************** Terminology search ********************* -->
    <mat-tab label="Terminology search">
        <div *ngIf="!showResultContainer">
            <br>
            <label for="textToAnnotate">
                <span>Type the term you want to search for (single word or phrase):</span>
                <div class="tib-btn-info" 
                    matTooltip="Terminology search is used to search for a term in a controlled vocabulary. The annotation service will propose entities, that are best matching the whole provided phrase. If you want to receive all contained entities within your phrase, choose 'Entity recognition' above"
                    matTooltipPosition="right"
                    matTooltipSize="12px">
                </div>
            </label>
            <textarea type="text" id="textToAnnotate" [formControl]="textToAnnotate" placeholder="e.g. ‘Mona Lisa’ or ‘The Mona Lisa painting’"></textarea>
            <span class="subheading" >Select terminology sources</span>
            <div class="tib-btn-info" 
                matTooltip="Please select the datasources you want to search. Currently we don't provide DBpedia as a standalone source"
                matTooltipPosition="right"></div>
            
            <form [formGroup]="sourcesForm" (ngSubmit)="submit()" novalidate>
                <div style="font-size: 14px;"
                    *ngFor="let datasource of datasources; let i=index"
                    [ngClass]="{'greyout': datasource.disabled == true}">
                    
                    <div *ngIf="datasource.shownTS == true">
                        <input 
                            type="checkbox" 
                            formArrayName="selectedSources" 
                            [value]="datasource.value" 
                            [checked]="datasource.checked == true" 
                            [disabled]="datasource.disabled == true"
                            (change)="onCheckboxChange($event)" />
                        
                        {{datasource.name}}
                    </div>
                </div>
            </form>

            <span *ngIf="showTs4tibOntologySelect == true">Select Ontologies (optional)</span>
            <ng-select class="tib-select"
                *ngIf="showTs4tibOntologySelect == true"
                [items]="ts4tibOntologies"
                bindLabel="name"
                bindValue="id"
                groupBy="collection"
                orderBy="collection"
                [searchFn]="ngSearchts4tibOntologies"
                [multiple]="true"
                [closeOnSelect]="false"
                [selectableGroup]="true"
                [selectableGroupAsModel]="false"
                [compareWith]="compareOntologies"
                [(ngModel)]="selectedTs4tibOntologies"
                [virtualScroll]="true"
                appendTo="body">
                <ng-template ng-optgroup-tmp let-item="item">
                    {{item.collection || '8 - Other'}}
                </ng-template>
            </ng-select>
            
            <span class="subheading">Settings</span><br/>   
            <input 
            type="checkbox" 
            [(ngModel)]="allowDuplicates"
            [value]="allowDuplicates" 
            [checked]=false
            /> <span style="font-size: 14px;">Allow class duplicates</span>
            <div class="tib-btn-info" 
            matTooltip="If set, the result hierarchy graph may contain the same class multiple times (in different branches). This will give you a more complete view of the original results but may show the same information multiple times.
            Every class will still be shown only once per branch in the hierarchy tree to avoid circles (circles are possible in graphs but not in trees like taxonomies)"
            matTooltipPosition="right"></div>
           
            <div class="btn-list">
                <!-- <button type="button" class="btn-tib btn-settings" (click)="toggleSettings()"></button> --><div style="width: 7.25rem;"></div>
                <button type="submit" class="btn-tib btn-tib--primary" (click)="terminologySearch()">Search</button>
                <button type="button" class="btn-tib btn-tib--secondary" (click)="clearAll()">Reset</button>
            </div>
        </div>
    </mat-tab>
    <!-- ********************** Entity Recognition ********************* -->
    <mat-tab label="Entity linking">
        <div *ngIf="!showResultContainer">
            <br>
            <label for="textToAnnotate">
                <span>Type the text you want to run entity recognition on (single words or whole sentences):</span>
                <div class="tib-btn-info" 
                    matTooltip="Use Entity linking to map as many words as possible, of your input text, to entities from the datasources. If you want to search for a single term, that is described by your text, choose 'Terminology search' above"
                    matTooltipPosition="right"
                    matTooltipSize="12px">
                </div>
            </label>
            <textarea id="textToAnnotate" [formControl]="textToAnnotate" placeholder="e.g. ‘Mona Lisa in Louvre’ or ‘The Mona Lisa painting in the Louvre Museum, Paris’"></textarea>
            <span class="subheading" >Select terminology sources:</span>
            <div class="tib-btn-info" 
                matTooltip="Please select the datasources you want to search. Currently we don't provide DBpedia as a standalone source"
                matTooltipPosition="right">
            </div>
            <form [formGroup]="sourcesForm" (ngSubmit)="submit()" novalidate>
                <div style="font-size: 14px;"
                    *ngFor="let datasource of datasources; let i=index"
                    [ngClass]="{'greyout': datasource.disabled == true}" >
                    
                    <div *ngIf="datasource.shownER == true">
                        <input 
                            type="checkbox" 
                            formArrayName="selectedSources" 
                            [value]="datasource.value" 
                            [checked]="datasource.checked == true" 
                            [disabled]="datasource.disabled == true"
                            (change)="onCheckboxChange($event)" />
                        
                        {{datasource.name}}
                    </div>
                </div>
            </form>
            <span class="subheading" >Settings:</span><br/>   
            <input 
            type="checkbox" 
            [(ngModel)]="allowDuplicates"
            [value]="allowDuplicates" 
            [checked]=false
            /> <span style="font-size: 14px;">Allow class duplicates</span>
            <div class="tib-btn-info" 
            matTooltip="If set, the result hierarchy graph may contain the same class multiple times (in different branches). This will give you a more complete view of the original results but may show the same information multiple times.
            Every class will still be shown only once per branch in the hierarchy tree to avoid circles (circles are possible in graphs but not in trees like taxonomies)"
            matTooltipPosition="right"></div>
            
            <div class="btn-list">
                <!-- <button type="button" class="btn-tib btn-settings" (click)="toggleSettings()"></button> --><div style="width: 7.25rem;"></div>
                <button type="submit" class="btn-tib btn-tib--primary" (click)="entityRecognition()">Search</button>
                <button type="button" class="btn-tib btn-tib--secondary" (click)="clearAll()">Reset</button>
            </div>
        </div>
    </mat-tab>

     <!-- ********************** Integration ********************* -->
    <mat-tab label="Integration">
        <br>
        <div *ngIf="!showResultContainer">
            <b>ANTELOPE</b> can be used in various ways. You may:<br>
            <ul style="margin-top: 10px;">
                <li>Use this website directly for your search</li>
                <li><a href="#embedd">Embedd</a> the ANTELOPE search form in your website</li>
                <li>Connect to our <a href="#api">RESTful API</a></li>
            </ul>
        </div>
        <br>
        <div id="embedd">
            <h3>Embedding via iFrame</h3>
            <div>Copy the code below and place it on your website or web-based software.
                This will display the <b>ANTELOPE</b> frontend component within your site.
                <br/><br/>
                <pre>
    <code>&lt;iframe 
        src=&quot;http://localhost:9000/api/annotation/entities/selectcomponent&quot; 
        height=&quot;600&quot; width=&quot;800&quot; name=&quot;antelope&quot; id=&quot;antelope-iframe&quot; sandbox=&quot;allow-scripts&quot;&gt;
    &lt;/iframe&gt;</code>
                </pre>
                You may send search requests to the component from your own site. 
                After your users select entities within the <b>ANTELOPE</b> component, the results are available in your site for further use.
                For detailled documentation of embedding <b>ANTELOPE</b> see <a href="">here</a>.
                 
            </div>
        </div>
        <br><br>
        <div id="api">
            <h3>RESTful API</h3>
            <p>You can use the full functionality of this website via our API. <br>
                have a look at the <a href="/v3/api-docs/openapi" target="_blank">API docs</a>
            </p>
        </div>
    </mat-tab>
</mat-tab-group>

<p id="msg" class="error">{{msg}}</p>
<p id="err" class="error">{{err}}</p>

<!-- ********************** Results ********************* -->    
<div [hidden]="!showResultContainer" class="results-container">
    <div class="search-collapsed">
        <span>{{ textToAnnotate.value }}</span>
        <div class="search-collapsed-buttons">
            <button type="button" class="btn-tib btn-settings" (click)="toggleSettings()"></button>
            <button type="button" class="btn-tib btn-tib--secondary" (click)="clearAll()">Change</button>
        </div>
    </div>
    <span class="results-label">{{ resultCount }} results in {{ selectedSources.length }} terminology sources</span>
    <mat-tab-group>
        <mat-tab label="Graph">
            <div class="tib-btn-info" 
                matTooltip="Use the mousewheel to zoom in/out. Use drag and drop to move the graph."
                matTooltipPosition="right"
                matTooltipSize="12px">
            </div>
            <jhi-graph-tidytree></jhi-graph-tidytree>
        </mat-tab>
        <mat-tab label="Table">
            <table class="table table-striped" #result_table>
                <thead>
                    <tr>
                      <th>Source</th>
                      <th>Entity label</th>
                      <th>ID</th>
                      <th>URI</th>
                      <th>Classes</th>
                    </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let entity of annotation.entities">
                    <td>{{ entity.source }}</td>
                    <td>{{ entity.label }}</td>
                    <td>{{ entity.id }}</td>
                    <td><a href='{{ entity.URI }}' target="_blank">{{ entity.URI }}</a></td>
                    <td>n.n.</td>
                  </tr>
                </tbody>
              </table>
        </mat-tab>
        <!-- <mat-tab label="JSON">
            <button style="margin:5px;margin-left:157px;" class="btn-tib btn-tib--primary" [cdkCopyToClipboard]="annotation | json">Copy</button>
            <button class="btn-tib btn-tib--primary" (click)="saveJson()">Download</button>
            <pre><p style="font-size:11px;">{{ annotation | json}}</p></pre>
        </mat-tab> -->
    </mat-tab-group>
</div>

<div *ngIf="!showResultContainer">
    <br><br>
    <br><br>
</div>